{% extends "core/base.html" %}

{% block content %}
<section class="container bg-white border p-4">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group row">
            <label for="id_title" class="col-sm-12 col-form-label">Título*</label>
            <div class="col-sm-12">
                {{form.title}}
            </div>
        </div>
        <div class="form-group row">
            <label for="id_itineraries" class="col-sm-12 col-form-label">Master*</label>
            <div class="col-sm-12">
                {{form.masters}}
            </div>
        </div>
        <div class="form-group row">
            <label for="id_type" class="col-sm-12 col-form-label">Tipo de proyecto*</label>
            <div class="col-sm-12">
                {{form.type}}
            </div>
        </div>
        <div class="form-group row">
            <label for="id_title" class="col-sm-12 col-form-label">
                Indioma*
                <a class="text-muted notification-popper" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-content="El idioma elegido debe ser uno de los idiomas utilizados por la enseñanza del master. La Comisión Académica de la Escuela, evaluará la propuesta con competencias en ese idioma.">
                    <i class="fas fa-info-circle"></i>
                </a>
            </label>            
            <div class="col-sm-12">
                {{form.language}}
            </div>
        </div>
        <div class="form-group row">
            <div class="col-8 col-sm-4 col-md-3 col-lg-2">
                Segundo tutor
                <a class="text-muted notification-popper" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-content="En el caso de un supervisor externo, debe proporcionarse información sobre su afiliación, posición y nivel académico acreditado.">
                    <i class="fas fa-info-circle"></i>
                </a>
            </div>
            <div class="col-4 col-sm-8 col-md-9 col-lg-10 d-flex align-items-center">
                <span class="switch switch-sm">
                    <input type="checkbox" name="has_tutor2" class="switch" id="tutorCheck">
                    <label for="tutorCheck"></label>
                </span>
            </div>
        </div>
        <div class="row block mb-4">
            <div class="col-sm-12">
                Tutor 2
            </div>
            <div class="pl-3 pl-sm-5 col-sm-12">
                <div class="form-group row">
                    <label for="alumnoNameInput" class="col-sm-2 col-form-label">Nombre completo:*</label>
                    <div class="col-sm-10">
                        {{tutor2_form.name}}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="alumnoDireccionInput1" class="col-sm-2 col-form-label">Departamento:*</label>
                    <div class="col-sm-10">
                        {{tutor2_form.departament}}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="alumnoDniInput" class="col-sm-2 col-form-label">Area:*</label>
                    <div class="col-sm-10">
                        {{tutor2_form.area}}
                    </div>
                </div>
                <div class="form-group-row">
                    <label for="exampleFormControlFile1">Curriculum vitae:</label>
                    <div class="col-sm-10">
                        {{tutor2_form.curriculum_vitae}}
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-8 col-sm-4 col-md-3 col-lg-2">
                Establecer<br>alumno/s
                <a class="text-muted notification-popper" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-content="Activar en caso de que exista un acuerdo previo entre el estudiante y el supervisor (es). El estudiante debe haber cumplido los requisitos académicos">
                    <i class="fas fa-info-circle"></i>
                </a>    
            </div>
            <div class="col-4 col-sm-8 col-md-9 col-lg-10 d-flex align-items-center">
                <span class="switch switch-sm">
                    <input type="checkbox" name="has_student" class="switch" id="alumnoCheck">
                    <label for="alumnoCheck"></label>
                </span>
            </div>
        </div>
        <div class="row" id="student">
            <div class="col-sm-12">
                Alumno *
            </div>
            <div class="pl-3 pl-sm-5 col-sm-12">
                <div class="form-group row">
                    <label for="alumnoNameInput" class="col-sm-2 col-form-label">Nombre:</label>
                    <div class="col-sm-10">
                        {{student_form.name}}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="alumnoDireccionInput1" class="col-sm-2 col-form-label">Email:</label>
                    <div class="col-sm-10">
                        {{student_form.email}}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="alumnoDniInput" class="col-sm-2 col-form-label">DNI:</label>
                    <div class="col-sm-10">
                        {{student_form.dni}}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="alumnotlfInput" class="col-sm-2 col-form-label">Telefono:</label>
                    <div class="col-sm-10">
                        {{student_form.phone}}
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <label for="inputObjectives" class="col-sm-12 col-form-label">Objetivos*</label>
            <div class="col-sm-12 text-center">
                {{form.objectives}}
            </div>
        </div>
        <div class="form-group row">
            <label for="inputMethod" class="col-sm-12 col-form-label">Metodología*</label>
            <div class="col-sm-12 text-center">
                {{form.methodology}}
            </div>
        </div>
        <div class="form-group row">
            <label for="inputDocsAndForms" class="col-sm-12 col-form-label">
                Documentos y formatos*
                <a class="text-muted notification-popper" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-content="Dependiendo del tipo de Tfm, los documentos a entregar y su formato deben ser especificados">
                    <i class="fas fa-info-circle"></i>
                </a> 
            </label>
            <div class="col-sm-12 text-center">
                {{form.docs_and_forms}}
            </div>
        </div>
        <div class="form-group row">
            <label for="inputDocsAndForms" class="col-sm-12 col-form-label">
                Conicimientos requeridos
                <a class="text-muted notification-popper" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-content="Rellenar si debe de cumplirse alguno.">
                    <i class="fas fa-info-circle"></i>
                </a>   
            </label>
            <div class="col-sm-12 text-center">
                {{form.knowledge}}
            </div>
        </div>
        {{form.tutor1}}
        <div class="form-group row">
            <div class="col-sm-12">
                <input type="submit" class="btn btn-success" value="Guardar">
            </div>
        </div>
        <div class="form-group row">
            <div class="col-sm-12">
                <a class="btn btn-light" href="{% url back_url %}">Atras</a>
            </div>
        </div>
    </form>
</section>
{% endblock content %}

{% block scripts %}

{% load static %}
<script>
$(document).ready(function(){
    
    // Inicialización del estado del formulario
    inputShowHiddenBlockFunction($("#tutorCheck"), $("#id_tutor2-name"));
    setStudentsTfm()
    cleanEmptySelects()
    cleanFileFieldRequired("curriculum_vitae", "tutor2");

    // Añade la funcionalidades a un evento
    // OCulta y mustra el tutor opcional
    $("#tutorCheck").click(() => {
        inputShowHiddenBlockFunction(
            $("#tutorCheck"),
            $("#id_tutor2-name"),
            [
                $("#tutor2-curriculum_vitae-clear_id"),
                $("#id_tutor2-curriculum_vitae")
            ]
        )
    });

    // Oculta y muestra los campos para que haya mas de un alumno
    $("#alumnoCheck").click(() => {
        setStudentsTfm()
    });

    //Actualiza las areas
    $("#id_tutor2-departament").change(function() {
        let departaments_id = $(this).val()
        getListApi("/api/areas", departaments_id)
            .then(response => {
                updateSelect("id_tutor2-area", response, "Selecciona el area")
            }).catch(error => {
                alert(error)
            })
    })

});
</script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
{% endblock scripts %}